<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASTRO4 - Tu Energ√≠a de Hoy</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0a0a1a">
</head>
<body>
  <div class="container">
    <header>
      <a href="index.html" style="text-decoration:none;color:white;position:absolute;left:15px;top:15px;font-size:1.5rem;">‚Üê Inicio</a>
      <h1>üîÆ ASTRO4</h1>
    </header>
    <main class="dashboard">
      <div class="greeting">
        <h2>Hola, <span id="user-name">...</span></h2>
        <p class="date" id="today-date">...</p>
      </div>
      <section class="energy-section">
        <h3 class="section-title">Tu Energ√≠a Hoy</h3>
        <div class="energy-item"><span class="icon">‚òÄÔ∏è</span><div><div class="label">Occidental</div><div class="value" id="western-sign">...</div></div></div>
        <div class="energy-item"><span class="icon">üêâ</span><div><div class="label">Chino</div><div class="value" id="chinese-sign">...</div></div></div>
        <div class="energy-item"><span class="icon">üïâÔ∏è</span><div><div class="label">V√©dico</div><div class="value" id="vedic-sign">...</div></div></div>
        <div class="energy-item"><span class="icon">üî¢</span><div><div class="label">Numerolog√≠a</div><div class="value" id="numerology">...</div></div></div>
      </section>      <section class="actions-section">
        <h3 class="section-title">‚úÖ Haz Esto Hoy</h3>
        <div class="action-item"><span class="action-number">1</span><span id="action-1">...</span></div>
        <div class="action-item"><span class="action-number">2</span><span id="action-2">...</span></div>
        <div class="action-item"><span class="action-number">3</span><span id="action-3">...</span></div>
      </section>
      <section class="warning-section">
        <h3 class="section-title">‚ö†Ô∏è Evita Hoy</h3>
        <div class="warning-content"><span class="warning-icon">‚ö†Ô∏è</span><span id="warning-text">...</span></div>
      </section>
      <section class="extras-section">
        <div class="extras-grid">
          <div class="extra-item"><span class="icon">üé®</span><div class="label">Color</div><div class="value" id="lucky-color">...</div></div>
          <div class="extra-item"><span class="icon">üî¢</span><div class="label">N√∫mero</div><div class="value" id="lucky-number">...</div></div>
          <div class="extra-item"><span class="icon">‚è∞</span><div class="label">Hora de Poder</div><div class="value" id="power-hour">...</div></div>
        </div>
      </section>
      <div class="cta-premium">
        <h3>üíé Consulta con Tu Gu√≠a</h3>
        <p>¬øDudas sobre amor, carrera o dinero?</p>
        <textarea id="pregunta" placeholder="Escribe tu pregunta..." rows="3" style="width:100%;padding:10px;border-radius:8px;margin:10px 0;background:#1a1a2e;color:white;border:1px solid #4a4a6a;"></textarea>
        <button class="btn-premium" id="btn-consultar" onclick="enviarConsulta()">‚ú® Consultar</button>
        <div id="respuesta-consulta" style="margin-top:15px;padding:15px;background:rgba(255,255,255,0.1);border-radius:8px;display:none;"></div>
        <button id="btn-otra" onclick="otraConsulta()" style="display:none;margin-top:10px;padding:10px 20px;background:#4a4a6a;color:white;border:none;border-radius:8px;cursor:pointer;">üîÑ Otra Consulta</button>
      </div>
      <button class="btn-share" onclick="shareResults()">üì§ Compartir mi energ√≠a de hoy</button>
    </main>
    <footer><p>üêù Hecho por Colmena - 28/12/2025</p><p style="font-size:0.7rem;opacity:0.7;"><a href="#" onclick="alert('ASTRO4 no almacena tus datos.')" style="color:inherit;">Privacidad</a></p></footer>
  </div>  <script src="js/astro-calc.js"></script>
  <script src="js/actions-engine.js"></script>
  <script>
    var urlParams = new URLSearchParams(window.location.search);
    var nombre = urlParams.get('nombre');
    var fechaStr = urlParams.get('fecha');
    if (!nombre || !fechaStr) { window.location.href = 'index.html'; }
    
    document.getElementById('user-name').textContent = nombre;
    var today = new Date();
    document.getElementById('today-date').textContent = today.toLocaleDateString('es-MX', {weekday:'long',year:'numeric',month:'long',day:'numeric'});
    
    var birthDate = new Date(fechaStr);
    var western = getWesternSign(birthDate);
    var chinese = getChineseZodiac(birthDate.getFullYear());
    var vedic = getNakshatra(birthDate);
    var numerology = getNumerology(birthDate, nombre);
    
    document.getElementById('western-sign').textContent = western.name + ' (' + western.element + ')';
    document.getElementById('chinese-sign').textContent = chinese.animal + ' de ' + chinese.element;
    document.getElementById('vedic-sign').textContent = vedic.nakshatra;
    document.getElementById('numerology').textContent = 'Vida ' + numerology.lifeNumber + ' - ' + numerology.lifeMeaning.keyword;
    
    var result = generateActions(western, chinese, numerology, birthDate);
    document.getElementById('action-1').textContent = result.actions[0];
    document.getElementById('action-2').textContent = result.actions[1];
    document.getElementById('action-3').textContent = result.actions[2];
    document.getElementById('warning-text').textContent = result.warning;
    document.getElementById('lucky-color').textContent = result.color;
    document.getElementById('lucky-number').textContent = numerology.personalDay;
    document.getElementById('power-hour').textContent = result.hour;    
    function otraConsulta() {
      document.getElementById('pregunta').value = '';
      document.getElementById('respuesta-consulta').style.display = 'none';
      document.getElementById('btn-otra').style.display = 'none';
      document.getElementById('btn-consultar').style.display = 'inline-block';
    }
    
    async function enviarConsulta() {
      var pregunta = document.getElementById('pregunta').value;
      if (!pregunta.trim()) { alert('Escribe una pregunta primero'); return; }
      
      var btn = document.getElementById('btn-consultar');
      btn.textContent = 'üîÆ Consultando...';
      btn.disabled = true;
      
      var perfil = {
        western: western.name + ' (' + western.element + ')',
        chinese: chinese.animal + ' de ' + chinese.element,
        vedic: vedic.nakshatra,
        lifeNumber: numerology.lifeNumber,
        lifeMeaning: numerology.lifeMeaning.keyword,
        personalDay: numerology.personalDay
      };
      
      var promptText = 'ERES UN GUIA ESPIRITUAL SABIO que domina 4 tradiciones ancestrales. ' +
        'PERFIL COMPLETO DEL CONSULTANTE: ' +
        '1) OCCIDENTAL (' + perfil.western + '): Este signo revela su personalidad externa y emociones. ' +
        '2) CHINO (' + perfil.chinese + '): Este animal y elemento rigen sus ciclos de vida y destino. ' +
        '3) VEDICO (' + perfil.vedic + '): Esta constelacion lunar gobierna su alma y proposito espiritual. ' +
        '4) NUMEROLOGIA (Vida ' + perfil.lifeNumber + ' - ' + perfil.lifeMeaning + ', Dia Personal ' + perfil.personalDay + '): Estos numeros definen su mision de vida y la energia de HOY. ' +
        'PREGUNTA DEL CONSULTANTE: ' + pregunta + '. ' +
        'INSTRUCCIONES ESTRICTAS: ' +
        '1. Responde DIRECTAMENTE a la pregunta - si preguntan SI o NO, responde claramente primero. ' +
        '2. INTEGRA al menos 2 de los 4 sistemas en tu respuesta, explicando COMO se relacionan con la pregunta. ' +
        '3. Da UN consejo CONCRETO y ACCIONABLE para HOY. ' +
        '4. Usa lenguaje en segunda persona (tu, ti). ' +
        '5. NO repitas la explicacion del perfil. ' +
        '6. Maximo 150 palabras. ' +
        '7. Habla como un mentor sabio y cercano, no como horoscopo de revista. ' +
        'EJEMPLO DE BUENA RESPUESTA: Si preguntan sobre dinero y son Escorpio con Numero 11, di algo como: Tu intensidad de Escorpio combinada con tu Numero Maestro 11 te da intuicion financiera poderosa. HOY, con energia ' + perfil.personalDay + ', es buen momento para [accion concreta]. Confia en tu instinto pero verifica los numeros.';      
      try {
        var response = await fetch('/api/consulta', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: promptText })
        });
        var data = await response.json();
        document.getElementById('respuesta-consulta').style.display = 'block';
        document.getElementById('respuesta-consulta').innerHTML = '<strong>üîÆ Tu Gu√≠a:</strong><br><br>' + data.respuesta;
        document.getElementById('btn-otra').style.display = 'inline-block';
        btn.style.display = 'none';
      } catch (error) {
        document.getElementById('respuesta-consulta').style.display = 'block';
        document.getElementById('respuesta-consulta').innerHTML = '‚ùå Error. Intenta de nuevo.';
      }
      btn.textContent = '‚ú® Consultar';
      btn.disabled = false;
    }    
    function shareResults() {
      var text = 'üîÆ Mi energ√≠a ASTRO4:\n‚òÄÔ∏è ' + western.name + '\nüêâ ' + chinese.animal + '\nüïâÔ∏è ' + vedic.nakshatra + '\nüî¢ Vida ' + numerology.lifeNumber + '\n\n‚úÖ Hoy:\n1. ' + result.actions[0] + '\n2. ' + result.actions[1] + '\n3. ' + result.actions[2] + '\n\nDescubre: https://astro3-lovat.vercel.app';
      if (navigator.share) {
        navigator.share({ title: 'ASTRO4', text: text });
      } else {
        navigator.clipboard.writeText(text).then(function() { alert('¬°Copiado!'); });
      }
    }
  </script>
</body>
</html>