<!-- share-buttons.html - Componente de botones para compartir -->
<!-- C11 RAYO - Insertar despu√©s de los resultados en app.html -->

<!-- CSS para los botones de compartir -->
<style>
.share-section {
  margin-top: 30px;
  padding: 20px;
  background: rgba(255,255,255,0.05);
  border-radius: 16px;
  text-align: center;
}

.share-title {
  font-size: 18px;
  color: #e94560;
  margin-bottom: 15px;
  font-weight: 600;
}

.share-buttons {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}

.share-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  border: none;
  border-radius: 25px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
}

.share-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.share-btn.whatsapp {
  background: #25D366;
  color: white;
}

.share-btn.twitter {
  background: #1DA1F2;
  color: white;
}

.share-btn.download {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.share-btn.copy {
  background: rgba(255,255,255,0.1);
  color: white;
  border: 1px solid rgba(255,255,255,0.2);
}

.share-btn.native {
  background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
  color: white;
}

.share-btn svg {
  width: 18px;
  height: 18px;
}

.share-btn .icon {
  font-size: 18px;
}

/* Toast notification */
.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: #333;
  color: white;
  padding: 12px 24px;
  border-radius: 8px;
  opacity: 0;
  transition: all 0.3s ease;
  z-index: 1000;
}

.toast.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

/* Responsive */
@media (max-width: 480px) {
  .share-buttons {
    flex-direction: column;
    align-items: stretch;
  }
  
  .share-btn {
    justify-content: center;
  }
}
</style>

<!-- HTML de los botones -->
<div class="share-section" id="shareSection" style="display: none;">
  <div class="share-title">‚ú® Comparte tu perfil energ√©tico</div>
  <div class="share-buttons">
    <!-- Bot√≥n nativo (m√≥vil) -->
    <button class="share-btn native" id="btnNativeShare" onclick="handleNativeShare()">
      <span class="icon">üì§</span>
      <span>Compartir</span>
    </button>
    
    <!-- WhatsApp -->
    <button class="share-btn whatsapp" onclick="handleShareWhatsApp()">
      <span class="icon">üí¨</span>
      <span>WhatsApp</span>
    </button>
    
    <!-- Twitter/X -->
    <button class="share-btn twitter" onclick="handleShareTwitter()">
      <span class="icon">üê¶</span>
      <span>Twitter</span>
    </button>
    
    <!-- Descargar imagen -->
    <button class="share-btn download" onclick="handleDownloadImage()">
      <span class="icon">üì∑</span>
      <span>Guardar imagen</span>
    </button>
    
    <!-- Copiar link -->
    <button class="share-btn copy" onclick="handleCopyLink()">
      <span class="icon">üîó</span>
      <span>Copiar link</span>
    </button>
  </div>
</div>

<!-- Toast para notificaciones -->
<div class="toast" id="toast"></div>

<!-- JavaScript handlers -->
<script src="js/share-utils.js"></script>
<script>
// Recopilar datos del perfil actual
function getShareData() {
  return {
    name: document.getElementById('userName')?.textContent || 
          document.getElementById('name')?.value || 'Usuario',
    birthDate: document.getElementById('birthdate')?.value || '',
    birthHour: document.getElementById('birthhour')?.value || '',
    timezone: document.getElementById('timezone')?.value || '',
    western: document.querySelector('.western-sign')?.textContent || 
             document.querySelector('[data-tradition="western"]')?.textContent || '',
    chinese: document.querySelector('.chinese-sign')?.textContent ||
             document.querySelector('[data-tradition="chinese"]')?.textContent || '',
    vedic: document.querySelector('.vedic-sign')?.textContent ||
           document.querySelector('[data-tradition="vedic"]')?.textContent || '',
    numerology: document.querySelector('.numerology-number')?.textContent ||
                document.querySelector('[data-tradition="numerology"]')?.textContent || '',
    powerColor: document.querySelector('.power-color')?.textContent || '',
    powerNumber: document.querySelector('.power-number')?.textContent || '',
    actions: Array.from(document.querySelectorAll('.action-item')).map(el => el.textContent)
  };
}

// Mostrar toast
function showToast(message, duration = 3000) {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), duration);
}

// Handlers
async function handleNativeShare() {
  const data = getShareData();
  const success = await nativeShare(data);
  if (!success) {
    // Fallback a opciones individuales
    showToast('Usa los otros botones para compartir');
  }
}

function handleShareWhatsApp() {
  const data = getShareData();
  shareWhatsApp(data);
}

function handleShareTwitter() {
  const data = getShareData();
  shareTwitter(data);
}

async function handleDownloadImage() {
  const data = getShareData();
  showToast('Generando imagen...');
  try {
    await downloadShareImage(data);
    showToast('¬°Imagen guardada!');
  } catch (err) {
    showToast('Error al generar imagen');
    console.error(err);
  }
}

async function handleCopyLink() {
  const data = getShareData();
  const success = await copyShareLink(data);
  if (success) {
    showToast('¬°Link copiado! üìã');
  } else {
    showToast('Error al copiar link');
  }
}

// Mostrar secci√≥n de compartir cuando hay resultados
function showShareSection() {
  const section = document.getElementById('shareSection');
  if (section) {
    section.style.display = 'block';
  }
  
  // Mostrar/ocultar bot√≥n nativo seg√∫n soporte
  const nativeBtn = document.getElementById('btnNativeShare');
  if (nativeBtn && !navigator.share) {
    nativeBtn.style.display = 'none';
  }
}

// Auto-cargar datos de URL si existen
document.addEventListener('DOMContentLoaded', () => {
  const urlData = parseShareUrlParams();
  if (urlData.name || urlData.birthDate) {
    // Pre-llenar campos si vienen de URL compartida
    if (urlData.name && document.getElementById('name')) {
      document.getElementById('name').value = urlData.name;
    }
    if (urlData.birthDate && document.getElementById('birthdate')) {
      document.getElementById('birthdate').value = urlData.birthDate;
    }
    if (urlData.birthHour && document.getElementById('birthhour')) {
      document.getElementById('birthhour').value = urlData.birthHour;
    }
    if (urlData.timezone && document.getElementById('timezone')) {
      document.getElementById('timezone').value = urlData.timezone;
    }
  }
});
</script>
