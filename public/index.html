<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <title>ASTRO4 - Tu Gu√≠a C√≥smica</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Nunito:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#c9a96e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <style>
    :root {
      --bg-primary: #0d0d1a;
      --bg-secondary: #1a1a2e;
      --bg-card: rgba(255,255,255,0.08);
      --text-primary: #ffffff;
      --text-secondary: #a0a0c0;
      --accent: #ffd700;
      --accent-dark: #b8860b;
      --border: rgba(255,255,255,0.15);
      --gradient-purple: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-gold: linear-gradient(135deg, #f5af19 0%, #f12711 100%);
      --gradient-cosmic: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
      --glow-purple: 0 0 20px rgba(102, 126, 234, 0.5);
      --glow-gold: 0 0 20px rgba(255, 215, 0, 0.5);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Nunito', sans-serif;
      background: var(--gradient-cosmic);
      min-height: 100vh;
      color: var(--text-primary);
      position: relative;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,0.3), transparent),
                        radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.2), transparent),
                        radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.4), transparent),
                        radial-gradient(2px 2px at 130px 80px, rgba(255,255,255,0.2), transparent),
                        radial-gradient(1px 1px at 160px 120px, rgba(255,255,255,0.3), transparent);
      background-size: 200px 200px;
      animation: twinkle 4s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
    .container {
      max-width: 420px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1;
    }
    h1 {
      font-size: 2rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 8px;
      background: var(--gradient-purple);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subtitle {
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.95rem;
      margin-bottom: 24px;
    }
    .install-banner {
      background: var(--gradient-purple);
      color: white;
      padding: 12px 16px;
      border-radius: 12px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--glow-purple);
    }
    .install-banner button {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
      padding: 6px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      backdrop-filter: blur(4px);
    }
    .card {
      background: var(--bg-card);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .form-group {
      margin-bottom: 16px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-primary);
    }
    input[type="text"],
    input[type="date"],
    input[type="time"],
    select {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 1rem;
      background: rgba(255,255,255,0.05);
      color: var(--text-primary);
      transition: all 0.3s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: var(--glow-purple);
    }
    .btn-primary {
      width: 100%;
      padding: 14px;
      background: var(--gradient-purple);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--glow-purple);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 30px rgba(102, 126, 234, 0.7);
    }
    .features {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin: 20px 0;
    }
    .feature {
      background: var(--bg-card);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      transition: all 0.3s;
    }
    .feature:hover {
      transform: translateY(-3px);
      box-shadow: var(--glow-purple);
    }
    .feature-icon {
      font-size: 2rem;
      margin-bottom: 8px;
    }
    .feature-title {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.9rem;
    }
    .feature-desc {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 4px;
    }
    .footer {
      text-align: center;
      padding: 20px;
      color: var(--text-secondary);
      font-size: 0.85rem;
    }
    .footer a {
      color: #667eea;
      text-decoration: none;
    }
    .history-section {
      margin-top: 20px;
    }
    .history-item {
      background: var(--bg-card);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .history-item:hover {
      background: rgba(255,255,255,0.12);
      transform: translateX(4px);
    }
    .disclaimer {
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 16px;
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
    }

    .traditions-title {
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin: 20px 0 12px 0;
    }
    .traditions-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    .tradition-card {
      background: var(--bg-card);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    .tradition-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--glow-purple);
      border-color: #667eea;
    }
    .tradition-card img {
      width: 48px;
      height: 48px;
      object-fit: cover;
      border-radius: 50%;
      margin-bottom: 8px;
      border: 2px solid var(--border);
    }
    .tradition-card h3 {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 2px;
    }
    .tradition-card span {
      font-size: 0.65rem;
      color: var(--text-secondary);
    }
    .modal-icon {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 50%;
      border: 2px solid var(--accent);
    }
  </style>

  <!-- Analytics: Plausible (privacy-friendly, no cookies) -->
  <script defer data-domain="astro3-lovat.vercel.app" src="https://plausible.io/js/script.js"></script>
  <script>
    // Custom events helper
    window.trackEvent = function(name, props) {
      if (window.plausible) {
        window.plausible(name, {props: props});
      }
    };
  </script>
</head>
<body>
  <div class="container">
    <div class="lang-toggle">
      <button class="lang-btn active" onclick="setLang('es')" id="btn-es">ES</button>
      <button class="lang-btn" onclick="setLang('en')" id="btn-en">EN</button>
    </div>
    <div class="install-banner" id="installBanner">
      <p data-i18n="install">üì≤ Instala ASTRO4</p>
      <button onclick="installApp()" data-i18n="installBtn">Instalar</button>
    </div>
    <header>
      <h1>‚úß ASTRO4 ‚úß</h1>
      <p class="subtitle" data-i18n="subtitle">Tu Gu√≠a C√≥smica Personal</p>
    </header>
    <div class="main-card">
      <h2 data-i18n="discover">Descubre tu energ√≠a de hoy</h2>
      <p data-i18n="traditions">4 tradiciones ancestrales te gu√≠an.</p>
      <form id="onboarding-form">
        <div class="form-group">
          <label data-i18n="nameLabel">Tu nombre</label>
          <input type="text" id="nombre" data-i18n-placeholder="namePlaceholder" placeholder="¬øC√≥mo te llamas?" required>
        </div>
        <div class="form-group">
          <label data-i18n="birthLabel">Fecha de nacimiento</label>
          <div class="date-row">
            <select id="dia" required><option value="" data-i18n="day">D√≠a</option></select>
            <select id="mes" required><option value="" data-i18n="month">Mes</option></select>
            <select id="anio" required><option value="" data-i18n="year">A√±o</option></select>
          </div>
          <div class="time-row">
            <input type="time" id="hora" value="12:00">
          </div>
          <div class="tz-row">
            <select id="timezone">
              <option value="auto" data-i18n="tzAuto">Detectar automaticamente</option>
              <option value="-12">UTC-12 (Baker Island)</option>
              <option value="-11">UTC-11 (Samoa)</option>
              <option value="-10">UTC-10 (Hawaii)</option>
              <option value="-9">UTC-9 (Alaska)</option>
              <option value="-8">UTC-8 (Los Angeles)</option>
              <option value="-7">UTC-7 (Denver)</option>
              <option value="-6">UTC-6 (Mexico City)</option>
              <option value="-5">UTC-5 (New York)</option>
              <option value="-4">UTC-4 (Santiago)</option>
              <option value="-3">UTC-3 (Buenos Aires)</option>
              <option value="0">UTC+0 (London)</option>
              <option value="1">UTC+1 (Paris, Madrid)</option>
              <option value="2">UTC+2 (Cairo)</option>
              <option value="3">UTC+3 (Moscow)</option>
              <option value="4">UTC+4 (Dubai)</option>
              <option value="5">UTC+5 (Karachi)</option>
              <option value="5.5">UTC+5:30 (India)</option>
              <option value="6">UTC+6 (Dhaka)</option>
              <option value="7">UTC+7 (Bangkok)</option>
              <option value="8">UTC+8 (Beijing, Singapore)</option>
              <option value="9">UTC+9 (Tokyo)</option>
              <option value="10">UTC+10 (Sydney)</option>
              <option value="12">UTC+12 (Auckland)</option>
            </select>
          </div>
          <div class="time-hint" data-i18n="timeHint">Hora aproximada - opcional para mayor precision</div>
        </div>
        <button type="submit" class="btn-primary" data-i18n="revealBtn">‚ú® Revelar mi energ√≠a</button>
      </form>
    </div>
    <p class="traditions-title" data-i18n="learnMore">Conoce las tradiciones:</p>
    <div class="traditions-grid">
      <div class="tradition-card" onclick="openModal('western')">
        <img src="Sol.jpeg" alt="Occidental">
        <h3 data-i18n="western">Occidental</h3>
        <span data-i18n="westernSub">Zodiaco solar</span>
      </div>
      <div class="tradition-card" onclick="openModal('vedic')">
        <img src="Luna.jpeg" alt="V√©dico">
        <h3 data-i18n="vedic">V√©dico</h3>
        <span data-i18n="vedicSub">Nakshatra lunar</span>
      </div>
      <div class="tradition-card" onclick="openModal('chinese')">
        <img src="Dragon.jpeg" alt="Chino">
        <h3 data-i18n="chinese">Chino</h3>
        <span data-i18n="chineseSub">Animal y elemento</span>
      </div>
      <div class="tradition-card" onclick="openModal('numerology')">
        <img src="Numeros.jpeg" alt="Numerolog√≠a">
        <h3 data-i18n="numerology">Numerolog√≠a</h3>
        <span data-i18n="numerologySub">N√∫meros de vida</span>
      </div>
    </div>
    <footer>
      <p>üêù <span data-i18n="madeWith">Hecho con ‚ô• por</span> <a href="#">Colmena (C6)</a></p>
      <p><a href="#" onclick="showPrivacy()" data-i18n="privacy">Privacidad</a></p>
    </footer>
  </div>
  <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeModal()">√ó</button>
      <img class="modal-icon" id="modalIcon" src="" alt="">
      <h3 id="modalTitle"></h3>
      <p id="modalDesc"></p>
      <div id="modalFormSection">
        <div class="form-group">
          <label id="modalNameLabel">Tu nombre</label>
          <input type="text" id="modalNombre" placeholder="¬øC√≥mo te llamas?">
        </div>
        <div class="form-group">
          <label id="modalBirthLabel">Fecha de nacimiento</label>
          <div class="date-row">
            <select id="modalDia"><option value="">D√≠a</option></select>
            <select id="modalMes"><option value="">Mes</option></select>
            <select id="modalAnio"><option value="">A√±o</option></select>
          </div>
        </div>
        <button class="btn-primary" onclick="revealSingle()" id="modalBtn">‚ú® Revelar esta energ√≠a</button>
      </div>
      <div id="modalResultSection" class="hidden">
        <div class="result-box">
          <div class="result-label" id="resultLabel"></div>
          <div class="result-value" id="resultValue"></div>
          <div class="result-sub" id="resultSub"></div>
          <div class="result-insight" id="resultInsight"></div>
          <div class="result-desc" id="resultDesc" style="font-size:0.85rem;color:#6b5b4f;margin-top:10px;line-height:1.4;font-style:italic;"></div>
        </div>
        <button class="btn-secondary" onclick="resetModal()" id="btnTryAnother">‚Üê Volver</button>
      </div>
    </div>
  </div>
  <script src="js/astro-calc.js"></script>
  <script src="js/sign-descriptions.js"></script>
  <script src="js/mini-insights.js"></script>
  <script>
    const traditions = {
      western: { icon: 'Sol.jpeg', titleEs: '‚òÄÔ∏è Astrolog√≠a Occidental', titleEn: '‚òÄÔ∏è Western Astrology', descEs: 'Basada en la posici√≥n del Sol al nacer. Los 12 signos zodiacales revelan tu personalidad.', descEn: 'Based on the Sun position at birth. The 12 zodiac signs reveal your personality.', labelEs: 'Tu signo solar', labelEn: 'Your sun sign' },
      vedic: { icon: 'Luna.jpeg', titleEs: 'üïâÔ∏è Astrolog√≠a V√©dica', titleEn: 'üïâÔ∏è Vedic Astrology', descEs: 'Tradici√≥n milenaria de la India basada en la Luna y los Nakshatras.', descEn: 'Ancient Indian tradition based on the Moon and Nakshatras.', labelEs: 'Tu Nakshatra', labelEn: 'Your Nakshatra' },
      chinese: { icon: 'Dragon.jpeg', titleEs: 'üêâ Astrolog√≠a China', titleEn: 'üêâ Chinese Astrology', descEs: 'Sistema de 12 animales y 5 elementos basado en tu a√±o lunar.', descEn: 'System of 12 animals and 5 elements based on your lunar year.', labelEs: 'Tu animal chino', labelEn: 'Your Chinese animal' },
      numerology: { icon: 'Numeros.jpeg', titleEs: 'üî¢ Numerolog√≠a', titleEn: 'üî¢ Numerology', descEs: 'El poder de los n√∫meros revela tu misi√≥n y lecciones de vida.', descEn: 'The power of numbers reveals your mission and life lessons.', labelEs: 'Tu N√∫mero de Vida', labelEn: 'Your Life Number' }
    };
    let currentModal = null;
    const i18n = {
      es: {
        timeHint: "Hora aproximada - opcional para mayor precisi√≥n",
        tzAuto: "Detectar autom√°ticamente",
        tzLabel: "Zona horaria de nacimiento", install: "üì≤ Instala ASTRO4", installBtn: "Instalar", subtitle: "Tu Gu√≠a C√≥smica Personal", discover: "Descubre tu energ√≠a de hoy", traditions: "4 tradiciones ancestrales te gu√≠an.", nameLabel: "Tu nombre", namePlaceholder: "¬øC√≥mo te llamas?", birthLabel: "Fecha de nacimiento", day: "D√≠a", month: "Mes", year: "A√±o", revealBtn: "‚ú® Revelar mi energ√≠a", revealSingle: "‚ú® Revelar esta energ√≠a", western: "Occidental", westernSub: "Zodiaco solar", vedic: "V√©dico", vedicSub: "Nakshatra lunar", chinese: "Chino", chineseSub: "Animal y elemento", numerology: "Numerolog√≠a", numerologySub: "N√∫meros de vida", madeWith: "Hecho con ‚ô• por", privacy: "Privacidad", privacyMsg: "ASTRO4 respeta tu privacidad.", months: ["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"], learnMore: "Conoce las tradiciones:", back: "‚Üê Volver" },
      en: {
        timeHint: "Approximate time - optional for better accuracy",
        tzAuto: "Detect automatically",
        tzLabel: "Birth timezone", install: "üì≤ Install ASTRO4", installBtn: "Install", subtitle: "Your Personal Cosmic Guide", discover: "Discover your energy today", traditions: "4 ancestral traditions guide you.", nameLabel: "Your name", namePlaceholder: "What's your name?", birthLabel: "Date of birth", day: "Day", month: "Month", year: "Year", revealBtn: "‚ú® Reveal my energy", revealSingle: "‚ú® Reveal this energy", western: "Western", westernSub: "Solar zodiac", vedic: "Vedic", vedicSub: "Lunar nakshatra", chinese: "Chinese", chineseSub: "Animal & element", numerology: "Numerology", numerologySub: "Life numbers", madeWith: "Made with ‚ô• by", privacy: "Privacy", privacyMsg: "ASTRO4 respects your privacy.", months: ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"], learnMore: "Learn about traditions:", back: "‚Üê Back" }
    };
    let currentLang = localStorage.getItem('astro4_lang') || 'es';
    function openModal(type) {
      currentModal = type;
      const t = traditions[type];
      document.getElementById('modalIcon').src = t.icon;
      document.getElementById('modalTitle').textContent = currentLang === 'es' ? t.titleEs : t.titleEn;
      document.getElementById('modalDesc').textContent = currentLang === 'es' ? t.descEs : t.descEn;
      document.getElementById('modalBtn').textContent = i18n[currentLang].revealSingle;
      document.getElementById('modalNameLabel').textContent = i18n[currentLang].nameLabel;
      document.getElementById('modalBirthLabel').textContent = i18n[currentLang].birthLabel;
      document.getElementById('modalNombre').placeholder = i18n[currentLang].namePlaceholder;
      document.getElementById('btnTryAnother').textContent = i18n[currentLang].back;
      document.getElementById('modalNombre').value = document.getElementById('nombre').value;
      document.getElementById('modalDia').value = document.getElementById('dia').value;
      document.getElementById('modalMes').value = document.getElementById('mes').value;
      document.getElementById('modalAnio').value = document.getElementById('anio').value;
      document.getElementById('modalFormSection').classList.remove('hidden');
      document.getElementById('modalResultSection').classList.add('hidden');
      document.getElementById('modalOverlay').classList.add('active');
    }
    function closeModal(e) { if (!e || e.target === document.getElementById('modalOverlay')) { document.getElementById('modalOverlay').classList.remove('active'); } }
    function resetModal() { document.getElementById('modalFormSection').classList.remove('hidden'); document.getElementById('modalResultSection').classList.add('hidden'); }
    function revealSingle() {
      const nombre = document.getElementById('modalNombre').value;
      const dia = document.getElementById('modalDia').value;
      const mes = document.getElementById('modalMes').value;
      const anio = document.getElementById('modalAnio').value;
      if (!nombre || !dia || !mes || !anio) { document.getElementById('modalNombre').focus(); return; }
      document.getElementById('nombre').value = nombre;
      document.getElementById('dia').value = dia;
      document.getElementById('mes').value = mes;
      document.getElementById('anio').value = anio;
      let mesF = mes.length === 1 ? '0' + mes : mes;
      let diaF = dia.length === 1 ? '0' + dia : dia;
      const birthDate = new Date(anio + '-' + mesF + '-' + diaF + 'T12:00:00');
      const t = traditions[currentModal];
      let label = currentLang === 'es' ? t.labelEs : t.labelEn;
      let value = '', sub = '', insightKey = '';
      if (currentModal === 'western') {
        const sign = getWesternSign(birthDate, currentLang);
        value = sign.name; sub = (currentLang === 'es' ? 'Elemento: ' : 'Element: ') + sign.element;
        insightKey = sign.name;
      } else if (currentModal === 'chinese') {
        const chinese = getChineseZodiac(parseInt(anio), currentLang);
        value = chinese.animal; sub = chinese.element + ' ¬∑ ' + chinese.yinYang;
        insightKey = chinese.animal;
      } else if (currentModal === 'vedic') {
        const vedic = getNakshatra(birthDate);
        value = vedic.nakshatra; sub = currentLang === 'es' ? 'Constelaci√≥n lunar' : 'Lunar mansion';
        insightKey = vedic.nakshatra;
      } else if (currentModal === 'numerology') {
        const num = getNumerology(birthDate, nombre, currentLang);
        value = num.lifeNumber; sub = num.lifeMeaning.keyword + ' - ' + num.lifeMeaning.desc;
        insightKey = num.lifeNumber;
      }
      const insight = getMiniInsight(currentModal, insightKey, currentLang, birthDate);
      const desc = typeof getSignDescription === 'function' ? getSignDescription(currentModal, insightKey, currentLang) : '';
      document.getElementById('resultLabel').textContent = label;
      document.getElementById('resultValue').textContent = value;
      document.getElementById('resultSub').textContent = sub;
      document.getElementById('resultInsight').textContent = insight ? '‚ú® ' + insight : '';
      document.getElementById('resultDesc').textContent = desc || '';
      document.getElementById('modalFormSection').classList.add('hidden');
      document.getElementById('modalResultSection').classList.remove('hidden');
    }
    function setLang(lang) {
      currentLang = lang; localStorage.setItem('astro4_lang', lang); document.documentElement.lang = lang;
      document.getElementById('btn-es').classList.toggle('active', lang === 'es');
      document.getElementById('btn-en').classList.toggle('active', lang === 'en');
      document.querySelectorAll('[data-i18n]').forEach(el => { const key = el.getAttribute('data-i18n'); if (i18n[lang][key]) el.textContent = i18n[lang][key]; });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => { const key = el.getAttribute('data-i18n-placeholder'); if (i18n[lang][key]) el.placeholder = i18n[lang][key]; });
      updateMonths(); updateModalSelects();
    }
    function updateMonths() { const mesSelect = document.getElementById('mes'); mesSelect.innerHTML = '<option value="">' + i18n[currentLang].month + '</option>'; i18n[currentLang].months.forEach((m, idx) => { mesSelect.innerHTML += '<option value="' + (idx+1) + '">' + m + '</option>'; }); }
    function updateModalSelects() {
      const modalDia = document.getElementById('modalDia'), modalMes = document.getElementById('modalMes'), modalAnio = document.getElementById('modalAnio');
      modalDia.innerHTML = '<option value="">' + i18n[currentLang].day + '</option>'; for(let i=1; i<=31; i++) { modalDia.innerHTML += '<option value="'+i+'">'+i+'</option>'; }
      modalMes.innerHTML = '<option value="">' + i18n[currentLang].month + '</option>'; i18n[currentLang].months.forEach((m, idx) => { modalMes.innerHTML += '<option value="' + (idx+1) + '">' + m + '</option>'; });
      modalAnio.innerHTML = '<option value="">' + i18n[currentLang].year + '</option>'; for(let i=2010; i>=1920; i--) { modalAnio.innerHTML += '<option value="'+i+'">'+i+'</option>'; }
    }
    function showPrivacy() { alert(i18n[currentLang].privacyMsg); }
    function initPage() { const diaSelect = document.getElementById('dia'); for(let i=1; i<=31; i++) { diaSelect.innerHTML += '<option value="'+i+'">'+i+'</option>'; } const anioSelect = document.getElementById('anio'); for(let i=2010; i>=1920; i--) { anioSelect.innerHTML += '<option value="'+i+'">'+i+'</option>'; } setLang(currentLang); }
    initPage();
    let deferredPrompt; window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });
    function installApp() { if (deferredPrompt) { deferredPrompt.prompt(); deferredPrompt.userChoice.then((result) => { if (result.outcome === 'accepted') { document.getElementById('installBanner').style.display = 'none'; } deferredPrompt = null; }); } else { alert(currentLang === 'es' ? 'Para instalar:\n1. Toca el men√∫ ‚ãÆ\n2. Selecciona "A√±adir a pantalla de inicio"' : 'To install:\n1. Tap menu ‚ãÆ\n2. Select "Add to Home Screen"'); } }
    if (window.matchMedia('(display-mode: standalone)').matches) { document.getElementById('installBanner').style.display = 'none'; }
    document.getElementById('onboarding-form').addEventListener('submit', function(e) { e.preventDefault(); var nombre = document.getElementById('nombre').value; var dia = document.getElementById('dia').value; var mes = document.getElementById('mes').value; var anio = document.getElementById('anio').value; if(mes.length === 1) mes = '0' + mes; if(dia.length === 1) dia = '0' + dia; var fecha = anio + '-' + mes + '-' + dia; var hora = document.getElementById('hora').value || '12:00'; var tz = document.getElementById('timezone').value; if(tz === 'auto') tz = (-new Date().getTimezoneOffset()/60).toString(); window.location.href = 'app.html?nombre=' + encodeURIComponent(nombre) + '&fecha=' + fecha + '&hora=' + hora + '&tz=' + tz + '&lang=' + currentLang; });
  
    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('[SW] Registered'))
          .catch(err => console.log('[SW] Error:', err));
      });
    }

  
    // ===== PERSISTENCIA USUARIO (Tarea 2.1) =====
    function saveUserData() {
      const nombre = document.getElementById('nombre').value;
      const dia = document.getElementById('dia').value;
      const mes = document.getElementById('mes').value;
      const anio = document.getElementById('anio').value;
      
      if (nombre) localStorage.setItem('astro4_name', nombre);
      if (dia && mes && anio) {
        var hora = document.getElementById('hora').value || '12:00';
        var tz = document.getElementById('timezone').value;
        if(tz === 'auto') tz = (-new Date().getTimezoneOffset()/60).toString();
        localStorage.setItem('astro4_birthdate', JSON.stringify({dia, mes, anio, hora, tz}));
      }
    }
    
    function loadUserData() {
      // Cargar nombre
      const savedName = localStorage.getItem('astro4_name');
      if (savedName) {
        document.getElementById('nombre').value = savedName;
      }
      
      // Cargar fecha
      const savedBirth = localStorage.getItem('astro4_birthdate');
      if (savedBirth) {
        try {
          const birth = JSON.parse(savedBirth);
          if (birth.dia) document.getElementById('dia').value = birth.dia;
          if (birth.mes) document.getElementById('mes').value = birth.mes;
          if (birth.anio) document.getElementById('anio').value = birth.anio;
        } catch(e) {}
      }
    }
    
    // Guardar al cambiar campos
    document.addEventListener('DOMContentLoaded', function() {
      loadUserData();
      
      // Event listeners para guardar
      document.getElementById('nombre').addEventListener('change', saveUserData);
      document.getElementById('dia').addEventListener('change', saveUserData);
      document.getElementById('mes').addEventListener('change', saveUserData);
      document.getElementById('anio').addEventListener('change', saveUserData);
    });

  </script>
</body>
</html>